<!DOCTYPE html>
<html>
  <head>
    <script src="../js/lib/jquery-3.2.1.min.js" type="text/javascript"></script>
    <link href="../css/bootstrap.min.css" rel="stylesheet" />
    <script src="../js/bootstrap.min.js" type="text/javascript"></script>
  </head>
  <body>
    <button type="button" class="btn btn-primary" id="loadTIP" data-toggle="modal" data-target="#tipBox" data-backdrop="static">Load TIP</button>
    <div class="modal fade" id="tipBox" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Set default TIP</h4>
                </div>
                <div class="modal-body">
                    <div id="deploy"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" id="tipLoad">Load</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal" id="tipCancel">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <div id="snackbar"></div>
    <script>
      $(document).ready(function() {
        $('#loadTIP').on('click', function() {
          console.log("tip loader clicked");
          $select = $('#deploy');
          // call to server to load quiz names
          $.ajax({
            url: '../../survey_ids.php',
            dataType:'JSON',
            success:function(data){
              //clear the current content of the select
              $select.html('');
              $.each(data.surveyInfo, function(key, val) {
                //report to user if db empty (no data in table)
                if (val.surveyID == '0') {
                  $select.append('<div class=\"radio\"><label id=\"tipSelection\"><input type=\"radio\" name=\"optradio\" value=\"0\">No surveys saved</label></div>');
                  console.log("no items to display");
                } else {
                  //iterate over the data and create a list of buttons with data values to pass to load function
                  // if val.currentTIP is 1 meaning that it is the current tip, that tip will be selected by default
                  if (val.currentTIP == '1') {
                    $select.append('<div class=\"radio\"><label class=\"active\" id=\"tipSelection\"><input type=\"radio\" name=\"optradio\" value=\"' + val.surveyID + '\" checked=\"\">' + val.surveyName + '</label></div>');
                    console.log("TIP #" + val.surveyID + ", '" + val.surveyName + "' is the current default survey")
                    // otherwise it will not be selected
                  } else {
                    $select.append('<div class=\"radio\"><label id=\"tipSelection\"><input type=\"radio\" name=\"optradio\" value=\"' + val.surveyID + '\">' + val.surveyName + '</label></div>');
                  }
                }
              })
              console.log("list created");

              $('.radio').one('click', '#pass-data', function() {
                console.log("Survey name clicked");
                  var docID = document.getElementById('tipSelection').checked
                  if (docID == 0) {
                    console.log("no data");
                  } else {
                    console.log("new default tip set: #" + val.surveyID + ", '" + val.surveyName + "'");
                  }
                });

              $("#tipLoad").one('click', function() {
                  $.ajax({url: '../../set_default_tip.php',
                      data: {'ID':docID},
                      type: 'POST',
                      success:function(result) {
                      // survey.text loads quiz data into surveyjs editor
                        survey.text=result;
                        console.log("survey loaded");
                        snackBar("Survey loaded");
                      },
                      error:function() {
                        console.log("no survey to load");
                        snackBar("No survey to load");
                      }
                  });
              });
            },
            error:function() {
              $select.html('');
              //report to user if there is an error (db file missing)
              $select.append('<div class=\"radio\"><label id=\"tipSelection\"><input type=\"radio\" name=\"optradio\" value=\"-1\">Database not available</label></div>');
              console.log("database file not found");
            }
          });
        });
      });
    </script>
  </body>
</html>
